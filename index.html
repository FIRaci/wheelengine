<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel Engine - v19.0 (Final Polish)</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        #logic-map-container { width: 100%; height: 100%; background-color: #1a1a1a; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Wheel Engine</h1>
            <nav class="main-nav">
                <button class="nav-link active" data-page="wheel-studio">Studio Vòng Quay</button>
                <button class="nav-link" data-page="logic-brain">Bộ Não Logic</button>
            </nav>
            <div class="header-actions">
                <button id="toggle-mode-btn" class="btn btn-primary">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                        <path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                    </svg>
                    <span id="toggle-mode-text">Chơi</span>
                </button>
                <button id="import-btn" class="btn btn-secondary">Import Dự Án</button>
                <button id="export-btn" class="btn btn-secondary">Export Dự Án</button>
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
            </div>
        </header>

        <main class="app-main">
            <!-- PAGE 1: WHEEL STUDIO -->
            <div id="wheel-studio-page" class="app-page active">
                <div class="creator-panel">
                    <div id="panel-overlay"></div>
                    <div class="panel-content-wrapper">
                         <div class="panel-section">
                            <h2>Quản Lý Vòng Quay</h2>
                            <div class="form-group">
                                <label for="wheel-selector">Chọn Vòng Quay</label>
                                <div style="display: flex; gap: 10px;">
                                    <select id="wheel-selector" style="flex-grow: 1;"></select>
                                    <button id="delete-wheel-btn" class="btn btn-danger" title="Xóa vòng quay">Xóa</button>
                                </div>
                            </div>
                            <div class="btn-container">
                                <button id="copy-wheel-btn" class="btn btn-secondary">Copy Vòng Quay</button>
                                <button id="paste-wheel-btn" class="btn btn-secondary" disabled>Paste Vòng Quay</button>
                            </div>
                            <hr>
                            <div class="form-group"><label for="new-wheel-name">Tên Vòng Quay Mới</label><input type="text" id="new-wheel-name" placeholder="Vũ Khí, Kỹ Năng..."></div>
                            <button id="create-wheel-btn" class="btn btn-primary">Tạo Mới</button>
                            <hr>
                            <div id="quick-generate-panel">
                                <h4>Tạo Nhanh</h4>
                                <p class="form-hint">Tự động điền các ô vào vòng quay hiện tại.</p>
                                <div class="form-group">
                                    <label>1. Chọn Nguồn Dữ Liệu</label>
                                    <select id="generate-source-type">
                                        <option value="">-- Chọn Nguồn --</option>
                                        <option value="itemDatabase">Từ Kho Báu (Vật phẩm)</option>
                                        <option value="entities">Từ Thực Thể</option>
                                    </select>
                                </div>
                                <div id="generate-options-container">
                                    <div id="item-database-options" class="generate-sub-options">
                                        <div class="form-group">
                                            <label>2. Lọc Vật Phẩm Theo</label>
                                            <select id="item-filter-type">
                                                <option value="">-- Chọn cách lọc --</option>
                                                <option value="all">Toàn bộ</option>
                                                <option value="category">Danh Mục (Kho Chứa)</option>
                                                <option value="tags">Tags</option>
                                            </select>
                                        </div>
                                        <div id="category-filter-options" class="generate-sub-options">
                                            <div class="form-group">
                                                <label>3. Chọn Danh Mục</label>
                                                <select id="category-filter-select"></select>
                                            </div>
                                        </div>
                                        <div id="tag-filter-options" class="generate-sub-options">
                                             <div class="form-group">
                                                <label>3. Chọn Tags</label>
                                                <button id="open-tag-modal-btn" class="btn btn-secondary">Chọn Tags...</button>
                                                <div id="selected-tags-display" class="tags-display-container"></div>
                                             </div>
                                        </div>
                                    </div>
                                </div>
                                <button id="execute-generation-btn" class="btn btn-primary" disabled>Tạo Vòng Quay</button>
                            </div>
                        </div>
                        <div class="panel-section" id="wheel-settings-panel">
                             <h3 id="wheel-settings-title">Cài Đặt Vòng Quay</h3>
                            <div class="form-group"><label for="spin-count-variable">Biến Số Lần Quay</label><input type="text" id="spin-count-variable" list="variable-suggestions-settings" placeholder="so_lan_quay"></div>
                            <div class="form-group">
                                <label for="segment-removal-mode">Chế độ xóa ô sau khi trúng</label>
                                <select id="segment-removal-mode">
                                    <option value="none">Không xóa</option>
                                    <option value="temporary">Xóa Tạm Thời (Trong chuỗi quay)</option>
                                    <option value="permanent">Xóa Vĩnh Viễn (Hủy diệt)</option>
                                </select>
                            </div>
                            <div class="form-group"><label for="default-link">Liên kết mặc định</label><select id="default-link"></select></div>
                             <hr>
                             <h4>Cài đặt Âm thanh</h4>
                             <div class="form-group">
                                 <label for="tick-sound-upload">File âm thanh "Tick"</label>
                                 <div class="file-input-group">
                                    <input type="file" id="tick-sound-upload" class="audio-upload-input" accept="audio/*">
                                    <button id="clear-tick-sound-btn" class="delete-btn">X</button>
                                 </div>
                             </div>
                        </div>
                        <div class="panel-section">
                            <h3 id="segment-editor-title">Chỉnh Sửa Ô</h3>
                             <div class="form-group"><label for="segment-text">Nội dung ô (Tên Phần Thưởng)</label><input type="text" id="segment-text" list="item-suggestions"></div>
                             <div class="form-group"><label for="segment-description">Mô tả ẩn</label><textarea id="segment-description" rows="3" placeholder="Mô tả này sẽ hiện ra trong pop-up kết quả..."></textarea></div>
                            <div class="form-row">
                                <div class="form-group" style="flex-grow: 1;"><label for="segment-weight">Tỷ lệ (Trọng số)</label><input type="number" id="segment-weight" value="1" min="1"></div>
                                <div class="form-group"><label for="segment-color">Màu sắc</label><input type="color" id="segment-color" value="#8AC926"></div>
                            </div>
                            <div id="segment-action-panel">
                                <h4>Hành Động Kích Hoạt</h4>
                                 <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-executeMacro-enabled" class="custom-checkbox">
                                        <label for="action-executeMacro-enabled">Thực Thi Macro</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-executeMacro-details">
                                        <select id="action-executeMacro-target"></select>
                                    </div>
                                </div>
                                <hr style="margin: 0.75rem 0;">
                                 <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-setVariable-enabled" class="custom-checkbox">
                                        <label for="action-setVariable-enabled">Gán Giá Trị cho Biến</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-setVariable-details"><div id="set-variable-actions-container"></div><button id="add-set-variable-action-btn" class="btn btn-secondary btn-add-action">+ Thêm hành động</button></div>
                                </div>
                                 <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-setCollectionSlots-enabled" class="custom-checkbox">
                                        <label for="action-setCollectionSlots-enabled">Thiết Lập Số Lượng Ô</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-setCollectionSlots-details">
                                        <div class="form-group">
                                            <label>Chọn Kho Chứa</label>
                                            <select id="action-setCollectionSlots-target"></select>
                                        </div>
                                        <div class="form-group">
                                            <label>Số lượng ô</label>
                                            <input type="text" id="action-setCollectionSlots-value" placeholder="[RESULT], 5, bien_so...">
                                        </div>
                                    </div>
                                </div>
                                <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-addToCollection-enabled" class="custom-checkbox">
                                        <label for="action-addToCollection-enabled">Thêm vào Ô Trống Kế Tiếp</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-addToCollection-details">
                                        <div class="form-group">
                                            <label>Chọn Kho Chứa</label>
                                            <select id="action-addToCollection-target"></select>
                                            <p class="form-hint">Sẽ thêm kết quả của ô quay ([RESULT]) vào ô trống đầu tiên.</p>
                                        </div>
                                    </div>
                                </div>
                                 <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-setItemInSlot-enabled" class="custom-checkbox">
                                        <label for="action-setItemInSlot-enabled">Gán/Xóa Vật Phẩm Vào Ô</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-setItemInSlot-details">
                                        <div class="form-group"><label>Chọn Kho Chứa</label><select id="action-setItemInSlot-target"></select></div>
                                        <div class="form-group"><label>Vị trí ô</label><input type="text" id="action-setItemInSlot-slot" placeholder="[CURRENT]+1, 1..."></div>
                                        <div class="form-group"><label>Tên vật phẩm</label><input type="text" id="action-setItemInSlot-value" list="item-suggestions" placeholder="[RESULT], [NONE]..."></div>
                                    </div>
                                </div>
                                 <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-removeItems-enabled" class="custom-checkbox">
                                        <label for="action-removeItems-enabled">Xóa Vật Phẩm</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-removeItems-details">
                                        <div class="form-group"><label>Chọn Kho Chứa</label><select id="action-removeItems-target"></select></div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Chế độ</label>
                                                <select id="action-removeItems-mode">
                                                    <option value="random">Ngẫu nhiên</option>
                                                    <option value="oldest">Cũ nhất</option>
                                                    <option value="newest">Mới nhất</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Loại số lượng</label>
                                                <select id="action-removeItems-amountType">
                                                    <option value="specific">Số lượng cụ thể</option>
                                                    <option value="range">Khoảng ngẫu nhiên</option>
                                                    <option value="all">Toàn bộ</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="remove-items-amount-container">
                                            <div class="form-group remove-items-amount-specific active">
                                                <label>Giá trị</label>
                                                <input type="text" id="action-removeItems-amountValue1" placeholder="2, _biến_tạm...">
                                            </div>
                                            <div class="form-row remove-items-amount-range">
                                                <div class="form-group">
                                                    <label>Từ</label>
                                                    <input type="text" id="action-removeItems-amountValue2" placeholder="1">
                                                </div>
                                                <div class="form-group">
                                                    <label>Đến</label>
                                                    <input type="text" id="action-removeItems-amountValue3" placeholder="3">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-goToWheel-enabled" class="custom-checkbox">
                                        <label for="action-goToWheel-enabled">Chuyển đến Vòng Quay</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-goToWheel-details"><select id="action-target-wheel"></select></div>
                                </div>
                                 <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-playSound-enabled" class="custom-checkbox">
                                        <label for="action-playSound-enabled">Phát Âm thanh</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-playSound-details">
                                        <div class="file-input-group">
                                            <input type="file" id="action-sound-upload" class="audio-upload-input" accept="audio/*">
                                            <button id="clear-action-sound-btn" class="delete-btn">X</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="action-group">
                                    <div class="action-header">
                                        <input type="checkbox" id="action-conditional-enabled" class="custom-checkbox">
                                        <label for="action-conditional-enabled">Điều Kiện Quay Lại (Bảo Hiểm)</label>
                                        <span class="action-summary"></span>
                                    </div>
                                    <div class="action-details" id="action-conditional-details">
                                       <p class="condition-text">Nếu kết quả vòng quay sau là:</p>
                                       <div class="condition-row"><select id="condition-operator"><option value="<=">&lt;=</option><option value=">=">&gt;=</option><option value="==">==</option><option value="<">&lt;</option><option value=">">&gt;</option></select><input type="number" id="condition-value" value="3"></div>
                                       <p class="condition-text">thì được quay lại tối đa:</p>
                                       <div class="condition-row"><input type="number" id="condition-rerolls" value="1" min="1"><span>lần.</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="btn-container"><button id="copy-actions-btn" class="btn btn-secondary" title="Sao chép">Copy Hành Động</button><button id="paste-actions-btn" class="btn btn-secondary" title="Dán" disabled>Paste Hành Động</button></div>
                            <div class="btn-container"><button id="main-action-btn" class="btn btn-primary">Thêm Ô</button><button id="cancel-edit-btn" class="btn btn-secondary" style="display: none;">Hủy</button></div>
                            <h4 style="margin-top: 1.5rem;">Các ô hiện tại</h4>
                            <p id="total-weight-info"></p>
                            <ul id="segment-list"></ul>
                        </div>
                    </div>
                </div>
                <div class="viewer-panel">
                    <div class="wheel-display-area">
                        <h1 id="wheel-title"></h1>
                        <h3 id="spin-count-display"></h3>
                        <div class="wheel-container"><div class="wheel-marker"></div><canvas id="wheel-canvas" width="500" height="500"></canvas></div>
                        <div class="viewer-actions">
                            <button id="spin-button" class="btn btn-primary">QUAY!</button>
                            <button id="skip-button" class="btn btn-secondary">Bỏ Lượt (Skip)</button>
                            <button id="reset-spin-btn" class="btn btn-danger">Dừng & Hoàn Tác</button>
                        </div>
                    </div>
                    <div class="viewer-sidebar">
                        <div class="panel-section" id="presentation-wheel-panel">
                            <h2>Vòng Quay Hiện Tại</h2>
                            <div class="form-group">
                                <select id="presentation-wheel-selector"></select>
                           </div>
                       </div>
                        <div class="panel-section" id="entity-selector-panel">
                             <h2>Thực Thể Hoạt Động</h2>
                             <div class="form-group" id="active-entity-container">
                                <select id="active-entity-selector">
                                    <option value="none">-- Không có --</option>
                                </select>
                            </div>
                        </div>
                        <div class="panel-section" id="character-sheet-panel">
                            <h2 id="sidebar-title">Thông Tin</h2>
                            <nav id="sidebar-nav">
                                <button class="sidebar-tab-btn active" data-tab="stats-tab">Chỉ Số</button>
                            </nav>
                            <div id="sidebar-tab-content">
                                <div id="stats-tab" class="sidebar-tab active">
                                    <div id="entity-stats-display"></div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-section" id="log-panel">
                            <h3 class="log-title">Nhật ký sự kiện</h3>
                            <ul id="game-log"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE 2: LOGIC BRAIN -->
            <div id="logic-brain-page" class="app-page">
                <nav class="logic-sub-nav">
                    <button class="sub-nav-link active" data-subpage="templates-rules">Mẫu & Logic</button>
                    <button class="sub-nav-link" data-subpage="entities">Quản Lý Thực Thể</button>
                    <button class="sub-nav-link" data-subpage="item-database">Kho Báu (Vật Phẩm)</button>
                    <button class="sub-nav-link" data-subpage="tag-manager">Quản Lý Tags</button>
                    <button class="sub-nav-link" data-subpage="logic-map">Sơ Đồ Logic</button>
                </nav>
                <div id="templates-rules-subpage" class="logic-sub-page active">
                    <div class="logic-sidebar">
                        <div class="panel-section">
                            <h2>Biến Mẫu (Template)</h2>
                            <p class="form-hint">Cấu trúc biến mặc định cho mọi Thực Thể mới.</p>
                            <div id="variable-template-list"></div>
                            <hr>
                            <div class="form-group">
                                <label for="new-variable-name">Tên biến mới</label>
                                <input type="text" id="new-variable-name" placeholder="suc_manh, mau_toi_da...">
                            </div>
                            <div class="form-group">
                                <label for="new-variable-value">Giá trị Gốc (Base)</label>
                                <input type="text" id="new-variable-value" value="0">
                            </div>
                            <div class="form-group">
                                <label for="new-variable-icon-upload">Icon (Tùy chọn)</label>
                                <input type="file" id="new-variable-icon-upload" class="image-upload-input" accept="image/*">
                            </div>
                            <button id="add-variable-btn" class="btn btn-primary">Thêm Biến Mẫu</button>
                        </div>
                         <div class="panel-section">
                            <h2>Kho Chứa Mẫu</h2>
                            <p class="form-hint">Định nghĩa các loại trang bị, kỹ năng, vật phẩm...</p>
                            <ul id="collection-template-list"></ul>
                            <hr>
                            <div class="form-group">
                                <label for="new-collection-name">Tên Kho Chứa mới</label>
                                <input type="text" id="new-collection-name" placeholder="Trang Bị, Kỹ Năng...">
                            </div>
                            <button id="add-collection-btn" class="btn btn-primary">Thêm Kho Chứa</button>
                        </div>
                        <div class="panel-section">
                            <h2>Chuỗi Hành Động (Macro)</h2>
                            <ul id="macros-list"></ul>
                            <hr>
                            <button id="add-macro-btn" class="btn btn-primary">Thêm Macro Mới</button>
                        </div>
                        <div class="panel-section">
                            <h2>Biến Tính Toán</h2>
                            <ul id="computed-variables-list"></ul>
                            <hr>
                            <button id="add-computed-variable-btn" class="btn btn-primary">Thêm Biến Tính Toán</button>
                        </div>
                        <div class="panel-section">
                            <h2>Luật Điều Kiện</h2>
                            <ul id="rules-list"></ul>
                            <hr>
                            <button id="add-rule-btn" class="btn btn-primary">Thêm Luật Mới</button>
                        </div>
                    </div>
                    <div id="logic-editor" class="panel-section">
                        <div id="macro-editor-content" style="display: none;">
                            <h2 id="macro-editor-title">Chỉnh Sửa Macro</h2>
                            <div class="form-group">
                                <label for="macro-name-input">Tên Macro</label>
                                <input type="text" id="macro-name-input">
                            </div>
                            <div class="rule-block">
                                <h3 class="rule-block-title">THỰC HIỆN CÁC HÀNH ĐỘNG</h3>
                                <div id="macro-actions-container"></div>
                                <button id="add-macro-action-btn" class="btn btn-secondary btn-add-action">+ Thêm hành động</button>
                            </div>
                        </div>
                        <div id="computed-variable-editor-content" style="display: none;">
                            <h2 id="computed-variable-editor-title">Chỉnh Sửa Biến Tính Toán</h2>
                            <div class="form-group"> <label>Công thức</label> <input type="text" id="computed-variable-formula" placeholder="suc_manh_base + nhanh_nhen_base"></div>
                        </div>
                        <div id="rule-editor-content" style="display: none;">
                            <h2 id="rule-editor-title">Chỉnh Sửa Luật</h2>
                            <div class="form-group"><label for="rule-name-input">Tên Luật</label><input type="text" id="rule-name-input"></div>
                            <div id="rule-blocks-container"></div>
                            <div class="btn-container">
                                <button id="add-rule-if-else-btn" class="btn btn-secondary">+ Thêm khối NẾU...THÌ (ELSE IF)</button>
                                <button id="add-rule-else-btn" class="btn btn-secondary">+ Thêm khối NGƯỢC LẠI (ELSE)</button>
                            </div>
                        </div>
                        <p id="logic-editor-placeholder">Chọn một mục từ cột trái để chỉnh sửa.</p>
                    </div>
                </div>
                <div id="entities-subpage" class="logic-sub-page">
                    <div class="logic-sidebar">
                        <div class="panel-section">
                            <h2>Danh sách Thực Thể</h2>
                            <ul id="entity-list"></ul>
                            <hr>
                            <div class="form-row">
                                <input type="text" id="new-entity-name" placeholder="Tên thực thể mới...">
                                <button id="add-entity-btn" class="btn btn-primary">Thêm</button>
                            </div>
                            <hr>
                            <div class="form-group">
                                <label>Giao Dịch Dữ Liệu Thực Thể</label>
                                <div class="btn-container" style="margin-top: 0;">
                                    <button id="import-entities-btn" class="btn btn-secondary">Import (.json)</button>
                                    <button id="export-entities-btn" class="btn btn-secondary">Export (.json)</button>
                                    <input type="file" id="import-entities-input" accept=".json" style="display: none;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="entity-editor" class="panel-section">
                        <div id="entity-editor-content" style="display: none;">
                             <h2 id="entity-editor-title">Chỉnh sửa Thực Thể</h2>
                            <div class="form-group">
                                <label>Avatar</label>
                                <div class="image-preview-container avatar-preview">
                                    <img id="entity-avatar-preview" src="" class="image-preview" alt="Avatar Preview">
                                    <button id="clear-entity-avatar-btn" class="delete-btn" style="display: none;">X</button>
                                </div>
                                <input type="file" id="entity-avatar-upload" accept="image/*" class="image-upload-input">
                            </div>
                             <div class="form-group">
                                 <label for="entity-name-input">Tên Thực Thể</label>
                                 <input type="text" id="entity-name-input">
                             </div>
                             <hr>
                             <h3>Các biến số</h3>
                             <div id="entity-variables-list"></div>
                             <hr>
                             <h3>Các Kho Chứa</h3>
                             <div id="entity-collections-list"></div>
                        </div>
                        <p id="entity-editor-placeholder">Chọn một thực thể từ cột trái để chỉnh sửa.</p>
                    </div>
                </div>
                <div id="item-database-subpage" class="logic-sub-page">
                    <div class="logic-sidebar">
                        <div class="panel-section">
                            <h2>Kho Báu</h2>
                            <p class="form-hint">Nơi định nghĩa tất cả vật phẩm trong dự án.</p>
                            <div id="item-database-list-container"></div>
                        </div>
                    </div>
                    <div id="item-editor" class="panel-section">
                        <div id="item-editor-content" style="display: none;">
                             <h2 id="item-editor-title">Chỉnh sửa Vật Phẩm</h2>
                             <div class="form-group">
                                 <label for="item-category-select">Danh Mục</label>
                                 <select id="item-category-select"></select>
                             </div>
                            <div class="form-group">
                                <label>Icon</label>
                                <div class="image-preview-container avatar-preview">
                                    <img id="item-icon-preview" src="" class="image-preview" alt="Item Icon Preview">
                                    <button id="clear-item-icon-btn" class="delete-btn" style="display: none;">X</button>
                                </div>
                                <input type="file" id="item-icon-upload" accept="image/*" class="image-upload-input">
                            </div>
                             <div class="form-group">
                                 <label for="item-name-input">Tên Vật Phẩm</label>
                                 <input type="text" id="item-name-input">
                             </div>
                             <div class="form-group">
                                <label for="item-description-input">Mô tả</label>
                                <textarea id="item-description-input" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="item-tags-input">Tags</label>
                                <input type="text" id="item-tags-input" list="tag-suggestions" placeholder="Gõ tên tag và nhấn Enter...">
                                <div id="item-tags-display" class="tags-display-container"></div>
                            </div>
                             <hr>
                             <h3>Hiệu Ứng Cộng Chỉ Số</h3>
                             <div id="item-effects-container"></div>
                             <button id="add-item-effect-btn" class="btn btn-secondary btn-add-action">+ Thêm Hiệu Ứng</button>
                        </div>
                        <p id="item-editor-placeholder">Chọn một vật phẩm từ cột trái để chỉnh sửa.</p>
                    </div>
                </div>
                <div id="tag-manager-subpage" class="logic-sub-page">
                     <div class="logic-sidebar">
                        <div class="panel-section">
                            <h2>Danh Sách Tags</h2>
                            <p class="form-hint">Quản lý tất cả tag trong dự án của bạn.</p>
                            <ul id="tag-manager-list"></ul>
                            <hr>
                             <div class="form-group">
                                <label for="new-tag-name-input">Tên Tag Mới</label>
                                <input type="text" id="new-tag-name-input" placeholder="vũ khí, phép thuật...">
                            </div>
                            <button id="add-new-tag-btn" class="btn btn-primary">Thêm Tag</button>
                        </div>
                    </div>
                    <div id="tag-editor" class="panel-section">
                        <div id="tag-editor-content" style="display: none;">
                             <h2 id="tag-editor-title">Chỉnh sửa Tag</h2>
                             <div class="form-group">
                                 <label for="tag-name-input">Tên Tag</label>
                                 <input type="text" id="tag-name-input">
                             </div>
                            <div class="form-group">
                                <label>Icon</label>
                                <div class="image-preview-container avatar-preview">
                                    <img id="tag-icon-preview" src="" class="image-preview" alt="Tag Icon Preview">
                                    <button id="clear-tag-icon-btn" class="delete-btn" style="display: none;">X</button>
                                </div>
                                <input type="file" id="tag-icon-upload" accept="image/*" class="image-upload-input">
                            </div>
                        </div>
                        <p id="tag-editor-placeholder">Chọn một tag từ cột trái để chỉnh sửa.</p>
                    </div>
                </div>
                <div id="logic-map-subpage" class="logic-sub-page">
                    <div id="logic-map-container"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="notification-toast"></div>
    <div id="result-modal" class="modal-container"> <div class="modal-content"> <h2 id="result-title"></h2> <p id="result-description"></p> <button id="close-modal-button" class="btn btn-primary">OK</button> </div> </div>
    <div id="item-info-modal" class="modal-container"> <div class="modal-content"> <div class="item-info-header"> <img id="item-info-icon" src="" alt="Item Icon"> <h2 id="item-info-title"></h2> </div> <p id="item-info-description"></p> <button id="close-item-info-modal-button" class="btn btn-primary">OK</button> </div> </div>
    <div id="confirmation-modal" class="modal-container"></div>
    <div id="tag-selection-modal" class="modal-container"> <div class="modal-content"> <h2>Chọn Tag để Tạo Vòng Quay</h2> <p class="form-hint">Chỉ những vật phẩm chứa TẤT CẢ các tag được chọn mới được thêm vào.</p> <div id="tag-list-for-generation" class="tags-selection-container"> </div> <div class="btn-container" style="justify-content:center; margin-top: 20px;"> <button id="confirm-tag-generation-btn" class="btn btn-primary">Tạo Vòng Quay</button> <button id="cancel-tag-generation-btn" class="btn btn-secondary">Hủy</button> </div> </div> </div>

    <datalist id="variable-suggestions-settings"></datalist>
    <datalist id="variable-suggestions-action"></datalist>
    <datalist id="item-suggestions"></datalist>
    <datalist id="tag-suggestions"></datalist>
    <script src="script.js"></script>
</body>
</html>

